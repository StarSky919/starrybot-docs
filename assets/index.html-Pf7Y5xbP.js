import{_ as A,g as a,h as S,c as v,a as t,t as _,f as h,i as x,v as T,j as P,o as g}from"./app-C29HdAKe.js";const d="https://api.prp.icel.site/api/v1",j={__name:"index.html",setup(I,{expose:e}){e();const l=a(""),n=a(""),i=a(!1),m=a(""),s=a(""),u=o=>({"Content-Type":"application/json","Access-Control-Allow-Origin":"https://api.prp.icel.site","Access-Control-Allow-Credentials":"true",Authorization:`Bearer ${o||""}`});function w(o){return localStorage.getItem(`@prp:${o}`)}function k(o,r){return localStorage.setItem(`@prp:${o}`,r)}function y(o){return localStorage.removeItem(`@prp:${o}`)}async function c(){const o=w("access_token");if(!o)return;const{detail:r,...p}=await fetch(`${d}/user/me`,{headers:u(o)}).then(f=>f.json());r!=="Not authenticated"&&(r||(await fetch(`${d}/user/me`,{method:"PATCH",body:JSON.stringify({anonymous_probe:!0}),headers:u(o)}),m.value=p.username,s.value=p.upload_token,i.value=!0))}async function C(o){if(!l.value)return alert("请输入用户名。");if(!n.value)return alert("请输入密码。");const{detail:r,...p}=await fetch(`${d}/user/login`,{method:"POST",headers:{...u(),"Content-Type":"application/x-www-form-urlencoded"},body:`username=${l.value}&password=${n.value}`}).then(f=>f.json());return r?alert("请输入正确的用户名和密码。"):(k("access_token",p.access_token),c())}function N(){y("access_token"),i.value=!1}S(c);const b={username:l,password:n,loggedIn:i,userName:m,uploadToken:s,baseURL:d,headers:u,getItem:w,setItem:k,removeItem:y,fetchInfo:c,onLogin:C,onLogout:N,ref:a,onMounted:S};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}},L={key:0},O={key:1},B={class:"row"},V={class:"row"};function $(I,e,l,n,i,m){return g(),v("div",null,[n.loggedIn?(g(),v("div",L,[e[5]||(e[5]=t("h1",null,"登录成功",-1)),t("p",null,"用户名："+_(n.userName),1),t("p",null,[e[2]||(e[2]=h("上传成绩 Token：")),e[3]||(e[3]=t("br",null,null,-1)),h(_(n.uploadToken),1)]),e[6]||(e[6]=t("p",null,"已为你自动设置“允许匿名查询”，现在你可以复制用户名和 Token 去绑定了。",-1)),t("p",{class:"row"},[e[4]||(e[4]=t("span",null,null,-1)),t("button",{onClick:n.onLogout,class:"button"},"退出登录")])])):(g(),v("div",O,[e[10]||(e[10]=t("h1",null,"登录到 PRP",-1)),t("form",{onSubmit:P(n.onLogin,["prevent"]),id:"login"},[t("p",B,[e[7]||(e[7]=t("span",null,"用户名：",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.username=s),type:"text",class:"input"},null,512),[[T,n.username,void 0,{trim:!0}]])]),t("p",V,[e[8]||(e[8]=t("span",null,"密码：",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.password=s),type:"password",class:"input"},null,512),[[T,n.password,void 0,{trim:!0}]])]),e[9]||(e[9]=t("p",{class:"row"},[t("span"),t("button",{type:"submit",class:"button"},"登录")],-1))],32)]))])}const R=A(j,[["render",$],["__file","index.html.vue"]]),U=JSON.parse('{"path":"/prp/","title":"","lang":"zh-CN","frontmatter":{"sidebar":false},"headers":[],"git":{"updatedTime":1751195385000,"contributors":[{"name":"StarSky919","email":"ss919p@gmail.com","commits":1,"url":"https://github.com/StarSky919"}]},"filePathRelative":"prp/index.md"}');export{R as comp,U as data};
